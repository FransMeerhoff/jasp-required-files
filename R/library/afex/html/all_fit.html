<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Refit 'lmer' model using multiple optimizers</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for all_fit {afex}"><tr><td>all_fit {afex}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Refit <code>lmer</code> model using multiple optimizers</h2>

<h3>Description</h3>

<p>Attempt to re-fit a [g]lmer model with a range of optimizers.
The default is to use all known optimizers for R that satisfy the
requirements (do not require explicit gradients, allow
box constraints), in four categories; (i) built-in
(<code>minqa::bobyqa</code>, <code>lme4::Nelder_Mead</code>), (ii) wrapped via optimx
(most of optimx's optimizers that allow box constraints require
an explicit gradient function to be specified; the two provided
here are really base R functions that can be accessed via optimx,
(iii) wrapped via nloptr, (iv) <code>dfoptim::nmkb</code>.
</p>


<h3>Usage</h3>

<pre>
all_fit(
  m,
  meth_tab = cbind(optimizer = rep(c("bobyqa", "Nelder_Mead", "optimx", "nloptwrap",
    "nmkbw"), c(1, 1, 2, 2, 1)), method = c("", "", "nlminb", "L-BFGS-B",
    "NLOPT_LN_NELDERMEAD", "NLOPT_LN_BOBYQA", "")),
  verbose = TRUE,
  maxfun = 1e+06,
  ...
)

nmkbw(fn, par, lower, upper, control)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>m</code></td>
<td>
<p>a fitted model with <code>lmer</code></p>
</td></tr>
<tr valign="top"><td><code>meth_tab</code></td>
<td>
<p>a matrix (or data.frame) with columns
- method the name of a specific optimization method to pass to the optimizer
(leave blank for built-in optimizers)
- optimizer the <code>optimizer</code> function to use</p>
</td></tr>
<tr valign="top"><td><code>verbose</code></td>
<td>
<p>print progress messages?</p>
</td></tr>
<tr valign="top"><td><code>maxfun</code></td>
<td>
<p>number of iterations to allow for the optimization rountine.</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>further arguments passed to <code><a href="../../lme4/html/merMod-class.html">update.merMod</a></code> such as <code>data</code>.</p>
</td></tr>
<tr valign="top"><td><code>fn</code></td>
<td>
<p>needed for <code>dfoptim::nmkb</code></p>
</td></tr>
<tr valign="top"><td><code>par</code></td>
<td>
<p>needed for <code>dfoptim::nmkb</code></p>
</td></tr>
<tr valign="top"><td><code>lower</code></td>
<td>
<p>needed for <code>dfoptim::nmkb</code></p>
</td></tr>
<tr valign="top"><td><code>upper</code></td>
<td>
<p>needed for <code>dfoptim::nmkb</code></p>
</td></tr>
<tr valign="top"><td><code>control</code></td>
<td>
<p>needed for <code>dfoptim::nmkb</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Needs packages <span class="pkg">nloptr</span>, <span class="pkg">optimx</span>, and <code>dfoptim</code> to try out all optimizers. <span class="pkg">optimx</span> needs to be loaded explicitly using <code>library</code> or <code>require</code> (see examples).
</p>
<p><code>nmkbw</code> is a simple wrapper function for fitting models with the corresponding optimizer. It needs to be exported for <code>lme4</code>, but should not be called directly by the user.
</p>


<h3>Value</h3>

<p>a list of fitted <code>merMod</code> objects
</p>


<h3>Note</h3>

<p>Very similar to the function of the same name that is part of <span class="pkg">lme4</span>. The present function will be removed eventually in favor of the <span class="pkg">lme4</span> function.
</p>


<h3>Author(s)</h3>

<p>Ben Bolker, minor changes by Henrik Singmann
</p>


<h3>See Also</h3>

<p>slice, slice2D in the bbmle package
</p>


<h3>Examples</h3>

<pre>

## Not run: 

# basic usage
require(optimx)
gm1 &lt;- glmer(cbind(incidence, size - incidence) ~ period + (1 | herd),
             data = cbpp, family = binomial)
gm_all &lt;- all_fit(gm1)
t(sapply(gm_all,fixef)) ## extract fixed effects
sapply(gm_all,logLik) ## log-likelihoods
sapply(gm_all,getME,"theta") ## theta parameters
!sapply(gm_all,inherits,"try-error") ## was fit OK?


## for GLMMs:
require("mlmRev") # for data
gm1 &lt;- mixed(use ~ age*urban + (1 | district), family = binomial, 
             data = Contraception, method = "LRT")
gm_all &lt;- all_fit(gm1$full_model)
sapply(gm_all,logLik)

## use allFit in combination with expand.re = TRUE
data("sk2011.2") # see example("mixed")
sk2_aff &lt;- droplevels(sk2011.2[sk2011.2$what == "affirmation",])
sk_m2 &lt;- mixed(response ~ instruction*inference*type+(inference*type||id), sk2_aff,
               expand_re = TRUE)
sk_m2
sk_m2_allFit &lt;- all_fit(sk_m2$full_model)
sk_m2_allFit # all fits fail

sk_m2_allFit &lt;- all_fit(sk_m2$full_model, data = sk_m2$data) # works
t(sapply(sk_m2_allFit,fixef))
sapply(sk_m2_allFit,logLik)


## End(Not run)
</pre>

<hr /><div style="text-align: center;">[Package <em>afex</em> version 0.28-0 <a href="00Index.html">Index</a>]</div>
</body></html>
